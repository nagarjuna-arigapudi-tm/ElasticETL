{
  "pipelines": [
    {
      "name": "simple-log-metrics",
      "enabled": true,
      "interval": "2m",
      "extract": {
        "elasticsearch_query": "{\n  \"query\": {\n    \"bool\": {\n      \"must\": [\n        {\n          \"range\": {\n            \"@timestamp\": {\n              \"gte\": __STARTTIME__\n            }\n          }\n        },\n        {\n          \"term\": {\n            \"cluster.name\": \"__CLUSTER__\"\n          }\n        }\n      ]\n    }\n  },\n  \"aggs\": {\n    \"total_logs\": {\n      \"value_count\": {\n        \"field\": \"@timestamp\"\n      }\n    },\n    \"error_logs\": {\n      \"filter\": {\n        \"term\": {\n          \"level\": \"ERROR\"\n        }\n      }\n    }\n  }\n}",
        "endpoints": [
          {
            "url": "http://localhost:9200/logs-*",
            "cluster_name": "development"
          }
        ],
        "json_paths": [
          "aggregations.total_logs.value",
          "aggregations.error_logs.doc_count"
        ],
        "timeout": "30s",
        "max_retries": 2,
        "start_time": "NOW-2min"
      },
      "transform": {
        "stateless": true,
        "substitute_zeros_for_null": true,
        "previous_results_sets": 0,
        "conversion_functions": [
          {
            "field": "value",
            "function": "convert_type",
            "from_type": "string",
            "to_type": "int"
          },
          {
            "field": "doc_count",
            "function": "convert_type",
            "from_type": "string",
            "to_type": "int"
          }
        ]
      },
      "load": {
        "streams": [
          {
            "type": "prometheus",
            "config": {
              "endpoint": "http://localhost:9091/metrics/job/elasticetl/instance/dev",
              "timeout": "15s"
            }
          }
        ]
      }
    }
  ],
  "global": {
    "resource_limits": {
      "max_memory_mb": 256,
      "max_cpu_percent": 50,
      "max_goroutines": 50,
      "max_connections": 25
    },
    "metrics": {
      "enabled": true,
      "port": 8090,
      "path": "/metrics",
      "interval": "30s"
    },
    "logging": {
      "level": "info",
      "format": "text",
      "output": "stdout"
    }
  }
}
